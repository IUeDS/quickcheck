<div>
    <div class="alert alert-warning" role="alert">
        This question type does not meet accessibility requirements and should not be used in public-facing courses. For all other courses, an accessible alternative should be provided to students.
    </div>
    <h3 class="qc-base-img-header">Base image <span class="sr-only">for question #{{ this.question.question_order }}</span></h3>
    <div class="qc-delete-base-image" *ngIf="this.image && !this.readOnly">
        <span class="qc-delete-btn qc-delete-option-btn-inline" 
            role="button" tabindex="0"
            (click)="this.deleteBaseImage()">
            <qc-delete-icon aria-hidden="true"></qc-delete-icon>
            <span class="sr-only">Delete base image for question #{{ this.question.question_order }}</span>
        </span>
    </div>
    <div *ngIf="this.image">
        <img [src]="this.image.img_url" [width]="this.image.width" [height]="this.image.height"/>
        <div class="row">
            <div class="col-4 form-group">
                <label for="qc-edit-img-width-{{this.question.id}}">Width (in px)</label>
                <input type="number" string-to-number class="form-control qc-edit-img-width" id="qc-edit-img-width-{{this.question.id}}" name="qc-edit-img-width-{{this.question.id}}" required
                    [(ngModel)]="this.image.width"
                    (ngModelChange)="this.onEdited(); this.onImageRatioChange($event, 'width', this.image)"
                    [disabled]="this.readOnly">
            </div>
            <div class="col-4 form-group">
                <label for="qc-edit-img-height-{{this.question.id}}">Height (in px)</label>
                <input type="number" string-to-number class="form-control qc-edit-img-height" id="qc-edit-img-height-{{this.question.id}}" name="qc-edit-img-height-{{this.question.id}}" required
                    [(ngModel)]="this.image.height"
                    (ngModelChange)="this.onEdited(); this.onImageRatioChange($event, 'height', this.image)"
                    [disabled]="this.readOnly">
            </div>
        </div>
        <div class="row">
            <div class="col-4 form-group">
                <div class="form-check">
                    <input type="checkbox" id="qc-edit-aspect-img-{{this.question.id}}"
                        (click)="this.togglePreserveAspectRatio(this.image)"
                        [disabled]="this.readOnly"
                        [checked]="this.image.preserveAspectRatio">
                    <label for="qc-edit-aspect-img-{{this.question.id}}">Preserve aspect ratio <span class="sr-only">for question #{{ this.question.question_order }}</span></label>
                </div>
            </div>
        </div>
    </div>
    <div *ngIf="!this.image && !this.readOnly">
        <div class="form-group">
            <label for="qc-base-image-upload-{{this.question.id}}">Upload an image</label>
            <input type="file" class="form-control-file" id="qc-base-image-upload-{{this.question.id}}" name="qc-base-image-upload-{{this.question.id}}" (change)="onSelectFile($event)">
        </div>
    </div>
    <h3>Draggable question options <span class="sr-only">for question #{{ this.question.question_order }}</span></h3>
    <table class="table table-bordered">
        <tr *ngFor="let draggable of this.draggables">
            <td class="qc-edit-draggable">
                <div *ngIf="!this.readOnly" class="qc-delete-draggable-btn">
                    <span class="qc-delete-btn qc-delete-option-btn-inline" 
                        role="button" tabindex="0"
                        (click)="this.deleteDraggable(draggable)">
                        <qc-delete-icon aria-hidden="true"></qc-delete-icon>
                        <span class="sr-only">Delete draggable for question #{{ this.question.question_order }}</span>
                    </span>
                </div>
                <div class="row" *ngIf="draggable.new_img || draggable.img_url">
                    <div class="form-group col-3" *ngIf="!draggable.img_url">
                        <label for="draggable-upload-{{this.question.id}}-{{this.draggable.id}}">Upload an image</label>
                        <input type="file" class="form-control-file" id="draggable-upload-{{this.question.id}}-{{this.draggable.id}}" name="draggable-upload-{{this.question.id}}-{{this.draggable.id}}" (change)="onSelectFile($event, draggable)">
                    </div>
                    <div class="form-group col-3" *ngIf="draggable.img_url">
                        <p>Preview</p>
                        <img [src]="draggable.img_url" [width]="draggable.width" [height]="draggable.height" />
                    </div>
                    <div class="form-group col-3">
                        <label for="count-{{this.question.id}}-{{draggable.id}}">Count</label>
                        <input type="text" id="count-{{this.question.id}}-{{draggable.id}}"
                            [(ngModel)]="draggable.count"
                            (ngModelChange)="this.onEdited()"
                            class="form-control"
                            required
                            [disabled]="this.readOnly">
                    </div>
                    <div class="form-group col-3">
                        <label for="width-{{this.question.id}}-{{draggable.id}}">Width</label>
                        <input type="text" id="width-{{this.question.id}}-{{draggable.id}}"
                            [(ngModel)]="draggable.width"
                            (ngModelChange)="this.onEdited(); this.onImageRatioChange($event, 'width', draggable)"
                            class="form-control"
                            required
                            [disabled]="this.readOnly || !draggable.img_url">
                    </div>
                    <div class="form-group col-3">
                        <label for="height-{{this.question.id}}-{{draggable.id}}">Height</label>
                        <input type="text" id="height-{{this.question.id}}-{{draggable.id}}"
                            [(ngModel)]="draggable.height"
                            (ngModelChange)="this.onEdited(); this.onImageRatioChange($event, 'height', draggable)"
                            class="form-control"
                            required
                            [disabled]="this.readOnly || !draggable.img_url">
                    </div>
                </div>
                <div class="row" *ngIf="draggable.new_img || draggable.img_url">
                    <div class="col-4 form-group">
                        <div class="form-check">
                            <input type="checkbox" id="qc-edit-aspect-img-{{draggable.id}}"
                                (click)="this.togglePreserveAspectRatio(draggable)"
                                [disabled]="this.readOnly || !draggable.img_url"
                                [checked]="draggable.preserveAspectRatio">
                            <label for="qc-edit-aspect-img-{{draggable.id}}">Preserve aspect ratio <span class="sr-only">for question #{{ this.question.question_order }}</span></label>
                        </div>
                    </div>
                </div>
                <div class="row" *ngIf="draggable.new_text || draggable.text">
                    <div class="form-group col-3">
                        <p>Preview</p>
                        <p [style.fontSize]="draggable.font_size + 'px'">{{ draggable.text }}</p>
                    </div>
                    <div class="form-group col-3">
                        <label for="count-{{this.question.id}}-{{draggable.id}}">Count</label>
                        <input type="text" id="count-{{this.question.id}}-{{draggable.id}}"
                            [(ngModel)]="draggable.count"
                            (ngModelChange)="this.onEdited()"
                            class="form-control"
                            required
                            [disabled]="this.readOnly">
                    </div>
                    <div class="form-group col-3">
                        <label for="text-{{this.question.id}}-{{draggable.id}}">Text</label>
                        <input type="text" id="text-{{this.question.id}}-{{draggable.id}}"
                            [(ngModel)]="draggable.text"
                            (ngModelChange)="this.onEdited()"
                            class="form-control"
                            required
                            [disabled]="this.readOnly">
                    </div>
                    <div class="form-group col-3">
                        <label for="font-size-{{this.question.id}}-{{draggable.id}}">Font size (px)</label>
                        <input type="text" id="font-size-{{this.question.id}}-{{draggable.id}}"
                            [(ngModel)]="draggable.font_size"
                            (ngModelChange)="this.onEdited()"
                            class="form-control"
                            required
                            [disabled]="this.readOnly">
                    </div>
                </div>
            </td>
        </tr>
    </table>
    <button class="btn btn-sm btn-primary qc-btn" type="button"
        (click)="this.addDraggableImage()"
        *ngIf="!this.readOnly">
        <span class="fa fa-plus" aria-hidden="true"></span> Add draggable image
        <span class="sr-only">for question #{{ this.question.question_order }}</span>
    </button>
    <button class="btn btn-sm btn-primary qc-btn" type="button"
        (click)="this.addDraggableText()"
        *ngIf="!this.readOnly">
        <span class="fa fa-plus" aria-hidden="true"></span> Add draggable text
        <span class="sr-only">for question #{{ this.question.question_order }}</span>
    </button>
    <qc-custom-feedback *ngIf="!this.readOnly"
        (onQuestionEdited)="this.onSubComponentEdited($event)"
        [question]="this.question">
    </qc-custom-feedback>
</div>
