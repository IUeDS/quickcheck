<p class="lead" ng-if="!vm.studentResponses.length">No responses were recorded for this attempt.</p>
<table class="table table-condensed qc-responses-table" ng-if="vm.showTableView">
    <thead>
        <th>Time</th>
        <th class="text-center">Is Correct</th>
        <th>Partial Credit</th>
        <th>Retry #</th>
        <th>Question</th>
        <th>Answer</th>
        <th>Answer Key</th>
    </thead>
    <tbody>
        <tr ng-repeat="response in vm.studentResponses"
            ng-class="response.is_correct == '1' ? 'success' : 'danger'">
            <td>{{ ::vm.utils.formatTimeWithTimeZone(response.created_at, vm.courseContext.time_zone) }}</td>
            <td class="text-center response-is-correct">
                <span ng-if="response.is_correct == '1'">
                    <span class="fa fa-check" aria-hidden="true"></span>
                    <span class="sr-only">Correct</span>
                </span>
                <span ng-if="response.is_correct != '1'">
                    <span class="fa fa-remove" aria-hidden="true"></span>
                    <span class="sr-only">Incorrect</span>
                </span>
            </td>
            <td class="qc-response-partial-credit"><span ng-if="response.partial_credit > 0">{{ response.partial_credit }}</span></td>
            <td>{{ response.custom_responses[0].retry_count }}</td>
            <td class="qc-response-question" ng-bind-html="response.custom_responses[0].question"></td>
            <td class="qc-response-answer">{{ response.custom_responses[0].answer }}</td>
            <td class="qc-response-answer-key">{{ response.custom_responses[0].answer_key }}</td>
        </tr>
    </tbody>
</table>
<div class="row qc-response-view" ng-if="!vm.showTableView">
    <div class="col-xs-12">
        <div class="row text-center">
            <div class="qc-progress-wrapper">
                <div round-progress
                    max="100"
                    current="vm.attempt.score"
                    color="#449D44"
                    bgcolor="#eaeaea"
                    radius="50"
                    stroke="15"
                    animation-delay="500"
                    aria-hidden="true">
                </div>
                <div class="text qc-attempt-percentage-score"><span class="sr-only">Score: </span>{{ vm.attempt.score | number : 0 }}%</div>
            </div>
            <p class="lead qc-attempt-questions-correct">{{ vm.getCountCorrect(vm.attempt) }} / {{ vm.questions.length }} correct</p>
        </div>
        <div class="row" ng-repeat="currentQuestion in vm.questions track by $index">
            <div class="col-xs-12">
                <div ng-if="currentQuestion.error" class="alert alert-danger qc-error-message" role="alert" tabindex="-1" ng-cloak>
                    <p class="lead">Error</p>
                    <p>There were no student responses that matched the options for this question. Either there was an error recording the student response, or the quiz was edited after the student took the quiz (i.e., a question option the student selected was deleted, or a new question was added).</p>
                </div>
                <div class="panel" ng-class="currentQuestion.studentResponse.isCorrect ? 'panel-success' : 'panel-danger'">
                    <div class="panel-heading">
                        <h4 class="lead">
                            <span ng-if="currentQuestion.studentResponse.isCorrect">
                                <span class="fa fa-check" aria-hidden="true"></span>
                                <span class="sr-only"><span ng-if="!vm.isStudent">The student</span><span ng-if="vm.isStudent">You</span> answered the following question correctly: </span>
                            </span>
                            <span ng-if="!currentQuestion.studentResponse.isCorrect">
                                <span class="fa fa-remove" aria-hidden="true"></span>
                                <span class="sr-only"><span ng-if="!vm.isStudent">The student</span><span ng-if="vm.isStudent">You</span> answered the following question incorrectly: </span>
                            </span>
                            <span>Question #{{ $index + 1 }}</span>
                        </h4>
                    </div>
                    <div class="panel-body">
                        <div class="qc-mc-options" ng-if="currentQuestion.question_type == 'multiple_choice'" ng-cloak>
                            <fieldset>
                                <legend class="qc-assessment-question" ng-bind-html="currentQuestion.question_text"></legend>
                                <div class="radio" ng-repeat="answerOption in currentQuestion.options" ng-class="{'qc-correct-answer-marked': answerOption.correct === 'true'}">
                                    <input type="radio" name="{{currentQuestion.id}}" value="{{answerOption.answer_text}}" disabled
                                        ng-checked="answerOption.studentAnswer" id="{{answerOption.id}}">
                                    <label class="qc-mc-option-response" for="{{answerOption.id}}">
                                        <span ng-bind-html="answerOption.answer_text"></span>
                                        <span ng-if="answerOption.correct === 'true'" class="qc-correct-text"> <span class="fa fa-long-arrow-left fa-lg" aria-hidden="true"></span> Correct answer</span>
                                    </label>
                                </div>
                            </fieldset>
                            <span ng-if="currentQuestion.multiple_correct == 'true'">(<em>Note: more than one response is considered correct for this multiple choice question. All possible correct responses have been marked.</em>)</span>
                        </div>
                        <div class="qc-mcorrect-options" ng-if="currentQuestion.question_type == 'multiple_correct'" ng-cloak>
                            <fieldset>
                                <legend class="qc-assessment-question" ng-bind-html="currentQuestion.question_text"></legend>
                                <div class="checkbox" ng-repeat="answerOption in currentQuestion.options" ng-class="{'qc-correct-answer-marked': answerOption.correct === 'true'}">
                                    <input type="checkbox" name="{{currentQuestion.id}}" value="{{answerOption.answer_text}}" ng-checked="answerOption.studentAnswer" disabled id="{{answerOption.id}}">
                                    <label for="{{answerOption.id}}">
                                        <span ng-bind-html="answerOption.answer_text"></span>
                                        <span ng-if="answerOption.correct === 'true'" class="qc-correct-text"> <span class="fa fa-long-arrow-left fa-lg" aria-hidden="true"></span> Correct answer</span>
                                    </label>
                                </div>
                            </fieldset>
                        </div>
                        <div class="qc-matrix-options" ng-if="currentQuestion.question_type == 'matrix'" ng-cloak>
                            <p class="qc-assessment-question" ng-bind-html="currentQuestion.question_text"></p>
                            <p ng-if="currentQuestion.studentResponse.partial_credit">Partial credit: {{ currentQuestion.studentResponse.partial_credit * 100 | number : 0 }}%</p>
                            <table class="table table-striped">
                                <caption class="sr-only">Matrix question types require you to match a row to a column. For each row in the table, you can select one column option, to match the row to the column. You can only select a maximum of one match for each row.</caption>
                                <thead>
                                    <tr>
                                        <th><span class="sr-only">Row label</span></th>
                                        <th ng-repeat="column in currentQuestion.columns">
                                            <span ng-bind-html="column.answer_text"></span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="row in currentQuestion.rows">
                                        <td>
                                            <span ng-bind-html="row.answer_text"></span>
                                        </td>
                                        <td ng-repeat="column in currentQuestion.columns" ng-class="{'qc-correct-answer-marked': vm.isMatrixAnswerCorrect(row, column)}">
                                            <div class="checkbox">
                                                <label class="sr-only" for="matrixrow-{{row.id}}-column-{{column.id}}">Check this box to match {{row.answer_text}} to {{column.answer_text}}</label>
                                                <input type="checkbox" name="{{row.id}}" value="{{column.answer_text}}" disabled
                                                ng-checked="row.studentAnswer.id == column.id"
                                                id="matrixrow-{{row.id}}-column-{{column.id}}">
                                                <span ng-if="vm.isMatrixAnswerCorrect(row, column)" class="qc-correct-text"> <span class="fa fa-long-arrow-left fa-lg" aria-hidden="true"></span> Correct answer</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="qc-matching-options" ng-if="currentQuestion.question_type == 'matching'" ng-cloak>
                            <p class="qc-assessment-question" ng-bind-html="currentQuestion.question_text"></p>
                            <p ng-if="currentQuestion.studentResponse.partial_credit">Partial credit: {{ currentQuestion.studentResponse.partial_credit * 100 | number : 0 }}%</p>
                            <div class="row">
                                <table class="table table-striped">
                                    <caption class="sr-only">Student respones for matching question #{{$index + 1}}.</caption>
                                    <tr>
                                        <th>Prompt</th>
                                        <th><span ng-if="vm.isStudent">Your</span><span ng-if="!vm.isStudent">Student's</span> answer</th>
                                        <th>Correct Answer <span class="fa fa-check qc-correct-icon" aria-hidden="true"></span></th>
                                    </tr>
                                    <tr ng-repeat="prompt in currentQuestion.prompts">
                                        <td>
                                            <label ng-bind-html="prompt.option_text" for="{{'select-matching-' + prompt.id}}"></label>
                                        </td>
                                        <td>
                                            <select class="form-control" id="{{'select-matching-' + prompt.id}}" disabled>
                                                <option value=""></option> <!-- blank option -->
                                                <option ng-repeat="selectableAnswer in currentQuestion.selectableAnswers"
                                                        value="{{selectableAnswer.id}}"
                                                        ng-bind-html="selectableAnswer.option_text"
                                                        ng-selected="selectableAnswer.id == prompt.studentAnswer.id">
                                                </option>
                                            </select>
                                        </td>
                                        <td>
                                            <span>{{prompt.matching_answer_text}}</span>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="dropdown-options" ng-if="currentQuestion.question_type == 'dropdown'" ng-cloak>
                            <p class="qc-assessment-question" ng-bind-html="currentQuestion.question_text"></p>
                            <div class="row student-dropdown-answer">
                                <div class="col-xs-12">
                                    <p ng-if="!currentQuestion.studentResponse.isCorrect"><span class="fa fa-remove qc-incorrect-icon" aria-hidden="true"></span> <span ng-if="vm.isStudent">Your</span><span ng-if="!vm.isStudent">Student's</span> Answer:</p>
                                    <span ng-repeat="prompt in currentQuestion.prompts | orderBy: 'answer_order'" class="qc-dropdown-section">
                                        <label ng-bind-html="prompt.answer_text" for="{{'select-dropdown-' + prompt.id}}"></label>
                                        <select class="form-control"
                                                id="{{'select-dropdown-' + prompt.id}}" disabled>
                                            <option></option> <!-- blank option -->
                                            <option ng-repeat="selectableAnswer in currentQuestion.selectableAnswers"
                                                value="{{selectableAnswer.id}}"
                                                ng-bind-html="selectableAnswer.answer_text"
                                                ng-selected="selectableAnswer.id == prompt.studentAnswer.id">
                                            </option>
                                        </select>
                                    </span>
                                </div>
                            </div>
                            <div class="row qc-correct-dropdown-answer" ng-if="!currentQuestion.studentResponse.isCorrect">
                                <div class="col-xs-12">
                                    <hr>
                                    <p><span class="fa fa-check qc-correct-icon" aria-hidden="true"></span> Correct Answer:</p>
                                    <span ng-repeat="prompt in currentQuestion.prompts | orderBy: 'answer_order'" class="qc-dropdown-section">
                                        <label ng-bind-html="prompt.answer_text" for="{{'select-dropdown-correct-' + prompt.id}}"></label>
                                        <select class="form-control"
                                                id="{{'select-dropdown-correct-' + prompt.id}}" disabled>
                                            <option></option> <!-- blank option -->
                                            <option ng-repeat="selectableAnswer in currentQuestion.selectableAnswers"
                                                value="{{selectableAnswer.id}}"
                                                ng-bind-html="selectableAnswer.answer_text"
                                                ng-selected="prompt.dropdown_answer_text == selectableAnswer.answer_text">
                                            </option>
                                        </select>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="textmatch" ng-if="currentQuestion.question_type == 'textmatch'" ng-cloak>
                            <p class="qc-assessment-question" ng-bind-html="currentQuestion.question_text"></p>
                            <div class="form-group has-feedback" ng-class="currentQuestion.studentResponse.isCorrect ? 'has-success' : 'has-error'">
                                <label for="textmatch-answer-box"><span ng-if="vm.isStudent">Your</span><span ng-if="!vm.isStudent">Student</span> answer <span class="sr-only">for question #{{ $index + 1 }}</span>:</label>
                                <input type="text" class="form-control" disabled ng-value="currentQuestion.studentAnswer" id="textmatch-answer-box"
                                    ng-class="currentQuestion.studentResponse.isCorrect ? 'qc-correct-answer-input' : 'qc-incorrect-answer-input'">
                            </div>
                            <div class="well textmatch-correct-answers">
                                <p>Correct answers: </p>
                                <ul class="fa-ul">
                                    <li ng-repeat="option in currentQuestion.options">
                                        <span class="fa-li fa fa-check qc-correct-icon qc-correct-icon-list" aria-hidden="true"></span> {{ option.textmatch_answer_text }}
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="numerical" ng-if="currentQuestion.question_type == 'numerical'" ng-cloak>
                            <p class="qc-assessment-question" ng-bind-html="currentQuestion.question_text"></p>
                            <div class="form-group">
                                <label for="numerical-answer-box"><span ng-if="vm.isStudent">Your</span><span ng-if="!vm.isStudent">Student</span>  answer:</label>
                                <input type="number" step="any" class="form-control" disabled ng-value="currentQuestion.studentAnswer" id="numerical-answer-box" ng-class="currentQuestion.studentResponse.isCorrect ? 'qc-correct-answer-input' : 'qc-incorrect-answer-input'">
                            </div>
                            <div class="well numerical-correct-answers">
                                <p>Correct answers: </p>
                                <ul class="fa-ul">
                                    <li ng-repeat="option in currentQuestion.options">
                                        <span class="fa-li fa fa-check qc-correct-icon qc-correct-icon-list" aria-hidden="true"></span>
                                        <span ng-if="option.answer_type === 'exact'">
                                            {{ option.numerical_answer }}, with margin of error of {{ option.margin_of_error }}
                                        </span>
                                        <span ng-if="option.answer_type === 'range'">
                                            Between {{ option.range_min }} and {{ option.range_max }}
                                        </span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
